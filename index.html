<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Classroom Game Hub</title>
  <style>
    body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
    .card { background: #333; padding: 20px; max-width: 400px; margin: 0 auto; border-radius: 10px; }
    input, select, button { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
    button { cursor: pointer; font-weight: bold; }
    .btn-login { background: #3498db; color: white; border: none; }
    .btn-reg { background: #2ecc71; color: white; border: none; }
    .hidden { display: none; }
    
    /* NEW: On-Screen Debug Box */
    #debug-log { 
      margin-top: 20px; 
      background: #000; 
      color: #0f0; 
      font-family: monospace; 
      padding: 10px; 
      border: 1px solid #444;
      white-space: pre-wrap;
      font-size: 12px;
    }
  </style>
</head>
<body>

  <div id="auth-container" class="card">
    <h1 id="title">Student Login</h1>

    <div id="login-form">
      <input type="text" id="login-name" placeholder="Name (e.g. eli)">
      <input type="password" id="login-pass" placeholder="Password (e.g. 1234)">
      
      <button type="button" id="login-btn" class="btn-login">LOGIN</button>
      
      <p style="text-align:center; font-size:0.8em; color:#ccc; cursor:pointer;" onclick="showReg()">
        Need an account? Register
      </p>
    </div>

    <div id="reg-form" class="hidden">
      <input type="text" id="reg-name" placeholder="Name">
      <input type="password" id="reg-pass" placeholder="Password">
      <select id="reg-class">
        <option value="BIO_P1">Biology Pd 1</option>
        <option value="ENV_P3">Env Science Pd 3</option>
      </select>
      <select id="reg-theme">
        <option value="Knight">Knight</option>
        <option value="Diva">Diva</option>
        <option value="SciFi">SciFi</option>
      </select>
      
      <button type="button" id="reg-btn" class="btn-reg">CREATE ACCOUNT</button>
      
      <p style="text-align:center; font-size:0.8em; color:#ccc; cursor:pointer;" onclick="showLogin()">
        Back to Login
      </p>
    </div>
  </div>

  <div id="debug-log">System Ready...</div>

  <script>
    // *** PASTE URL HERE ***
    const WEB_APP_URL = "PASTE_YOUR_EXEC_URL_HERE"; 
    // **********************

    function log(msg) {
      const box = document.getElementById('debug-log');
      box.innerText += "\n" + msg;
      console.log(msg);
    }

    function showReg() {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('reg-form').classList.remove('hidden');
      document.getElementById('title').innerText = "Register";
    }
    function showLogin() {
      document.getElementById('reg-form').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('title').innerText = "Login";
    }

    async function doLogin() {
      const name = document.getElementById('login-name').value;
      const pass = document.getElementById('login-pass').value;
      
      if(!name) { log("Error: Name empty"); return; }
      
      log("Step 1: Button clicked. Name=" + name);
      log("Step 2: Sending to " + WEB_APP_URL);

      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          redirect: 'follow',
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ action: "login", name: name, password: pass })
        });

        log("Step 3: Server status " + response.status);
        
        const result = await response.json();
        log("Step 4: Data received: " + JSON.stringify(result));

        if(result.status === "success") {
          log("LOGIN SUCCESS!");
          alert("Success! Welcome " + result.data.name);
        } else {
          log("LOGIN FAILED: " + result.message);
          alert("Failed: " + result.message);
        }

      } catch (err) {
        log("CRITICAL ERROR: " + err.message);
      }
    }
    
    async function doReg() {
      log("Registering...");
      // (Simplified logic for debugging login first)
      const name = document.getElementById('reg-name').value;
      const pass = document.getElementById('reg-pass').value;
      const cls = document.getElementById('reg-class').value;
      const thm = document.getElementById('reg-theme').value;

      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST',
          redirect: 'follow',
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ action: "register", name: name, password: pass, class_period: cls, theme: thm })
        });
        const result = await response.json();
        log("Reg Result: " + JSON.stringify(result));
        if(result.status === "success") { alert("Created! Please login."); showLogin(); }
      } catch (e) { log("Reg Error: " + e.message); }
    }

    // Attach listeners
    document.getElementById('login-btn').addEventListener('click', doLogin);
    document.getElementById('reg-btn').addEventListener('click', doReg);

  </script>
</body>
</html>
